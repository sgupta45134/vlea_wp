"use strict";jQuery(function(c){var e=function(){i.init(),t.init(),a.init()},t={init:function(){this.cacheDOM(),this.dependenciesInject()},cacheDOM:function(){this.dataTable=c(".vczapi-registrants-table"),this.overideAddtionRegistrationFields=c(".vczapi-override-registration-fields"),this.addtionalRegistrationFieldsTbl=c(".vczapi-registration-addtional-fields"),c(document).on("click",".vczapi-pro-admin-deny-registrant",this.changeRegistrationStatus.bind(this)),c(".meeting-webinar-registraion-fields-selector").select2(),this.overideAddtionRegistrationFields.on("click",this.showHideRegistrationAdditionalFields.bind(this))},dependenciesInject:function(){this.editMeetingsPageDataTable()},showHideRegistrationAdditionalFields:function(e){c(e.currentTarget).is(":checked")?this.addtionalRegistrationFieldsTbl.show():this.addtionalRegistrationFieldsTbl.hide()},editMeetingsPageDataTable:function(){var e=c("#post_ID").val();0<c(this.dataTable).length&&e&&c(this.dataTable).dataTable({ajax:{url:ajaxurl+"?action=get_registrants_lists&post_id="+e},dom:"Bfrtip",buttons:["csv","excel","print"],columns:[{data:"email"},{data:"first_name"},{data:"last_name"},{data:"create_time"},{data:"status"},{data:"change_status"}]})},changeRegistrationStatus:function(e){e.preventDefault();var t=c(e.currentTarget).data("meeting"),i=c(e.currentTarget).data("status"),a=c(e.currentTarget).data("post"),n=c(e.currentTarget).data("registrant-id"),s=c(e.currentTarget).data("registrant-email"),r=c(e.currentTarget).data("type");confirm("Are you sure you want to deny this registrant ?")&&(c(".vczapi-pro-admin-notices").html('<div class="vczapi-pro-admin-notice-success"><p>Loading.. Please wait..</div>'),c.post(ajaxurl,{action:"update_registrants_status",registrant_id:n,registrant_email:s,post_id:a,id:t,status:i,type:r}).done(function(e){e.success?(c(".vczapi-pro-admin-notices").html('<div class="vczapi-pro-admin-notice-success"><p>'+e.data+"</p></div>"),location.reload()):c(".vczapi-pro-admin-notices").html('<div class="vczapi-pro-admin-notice-error"><p>'+e.data+"</p></div>")}))}},i={init:function(){this.cacheDOM(),this.dependenciesInject(),this.evntListeners()},cacheDOM:function(){this.endDateCalendarInstance=null,this.enableRecurring=c("#vczapi-enable-recurring-meeting"),this.enableRegistration=c("#vczapi-enable-registration"),this.registrationType=c(".vczapi-registration-type-on-off"),this.endDate=c("#vczapi-end-date-time"),this.repeatInterval=c("#vczapi-repeat-interval"),this.frequency=c("#vczapi-recurrence-frequency"),this.noFixedTime=c(".vczapi-recurring-show-hide-no-fixed-time"),this.registrationSection=c(".vczapi-show-registration-section"),this.frequencyText=c(".vczapi-repeat-type-text"),this.recurringData=c(".vczapi-recurring-show-hide"),this.startDate=c("#datetimepicker"),this.hidePMI=c(".show-hide-pmi-radio"),this.pmiSelector=c("#vczapi-use-pmi"),this.occurrence={weekly:c(".vczapi-weekly-occurrence-show-hide"),monthy:c(".vczapi-monthly-occurrence-show-hide")},this.endDateTime,this.weeklyOccurrence=c('input[name="vczapi-weekly-occurrence[]"]'),this.monthlyOccurenceType=c('input[name="vczapi-monthly-occurrence-type"]')},dependenciesInject:function(){0<c(this.endDate).length&&(this.endDateCalendarInstance=c(this.endDate).datetimepicker({minDate:0,defaultDate:new Date,timepicker:!1,format:"Y-m-d",scrollMonth:!1})),0<c(this.enableRecurring).length&&(c(this.enableRecurring).is(":checked")&&"4"===c(this.frequency).val()?c(this.startDate).closest("tr").hide():c(this.startDate).closest("tr").show())},evntListeners:function(){this.frequency.on("change",this.showRepeatText.bind(this)),this.startDate.on("change",this.updateEndDateCalendar.bind(this)),this.frequency.on("change",this.updateEndDateCalendar.bind(this)),this.repeatInterval.on("change",this.updateEndDateCalendar.bind(this)),this.weeklyOccurrence.on("change",this.updateEndDateCalendar.bind(this)),this.monthlyOccurenceType.on("change",this.updateEndDateCalendar.bind(this)),c("#vczapi-monthly-occurrence").on("change",this.updateEndDateCalendar.bind(this)),c("#vczapi-monthly-occurence-week").on("change",this.updateEndDateCalendar.bind(this)),c("#vczapi-monthly-occurrence-day").on("change",this.updateEndDateCalendar.bind(this)),this.enableRecurring.on("click",this.showHideRecurringFields.bind(this)),this.enableRegistration.on("click",this.showHideBasedRegistrationsEnabledSetting.bind(this)),this.pmiSelector.on("change",this.changeBasedonPMI.bind(this))},getISODayOfWeek:function(e){var t=1;switch(e=parseInt(e)){case 1:t=7;break;case 2:t=1;break;case 3:t=2;break;case 4:t=3;break;case 5:t=4;break;case 6:t=5;break;case 7:t=6}return t},updateEndDateCalendar:function(){switch(console.log("ues"),this.frequency.val()){case"1":this.updateEndCalendarForDaily();break;case"2":this.updateEndCalendarForWeekly();break;case"3":this.updateEndCalendarForMonthly()}},updateEndCalendarForDaily:function(){var e=parseInt(this.repeatInterval.val()),t=moment(this.startDate.val()).add(e,"days").format("YYYY-MM-DD");this.endDateCalendarInstance.datetimepicker("setOptions",{minDate:t,value:t})},getNextOccurenceForWeek:function(e,t,i){return moment(e).isoWeekday()<=t?moment(e).isoWeekday(t):moment(e).add(parseInt(i),"weeks").isoWeekday(t)},updateEndCalendarForWeekly:function(){var a=parseInt(this.repeatInterval.val()),n=this.startDate.val(),t=[],i=this.getISODayOfWeek,s=this.getNextOccurenceForWeek;if(c('input[name="vczapi-weekly-occurrence[]"]:checked').each(function(){var e=i(c(this).val());t.push(e)}),0===t.length&&"undefined"!==t)return!1;var r=[];c(t).each(function(e,t){var i=s(n,t,a);r.push(i),console.log("list of dates",i.format("YYYY-MM-DD"))});var e=moment.min(r);this.endDateCalendarInstance.datetimepicker("setOptions",{minDate:e.format("YYYY-MM-DD"),value:e.format("YYYY-MM-DD")})},updateEndCalendarForMonthly:function(){var e=this.startDate.val(),t=parseInt(this.repeatInterval.val()),i=c('input[name="vczapi-monthly-occurrence-type"]:checked').val(),a=moment(e).add(t,"M");if("1"===i){var n=parseInt(c("#vczapi-monthly-occurrence").val()),s=parseInt(a.month());console.log(s),(1!==s||31!==n&&30!==n&&29!==n)&&(3!==s&&5!==s&&8!==s&&10!==s||31!==n)?this.endDateCalendarInstance.datetimepicker("setOptions",{minDate:a.date(n).format("YYYY-MM-DD"),value:a.date(n).format("YYYY-MM-DD")}):this.endDateCalendarInstance.datetimepicker("setOptions",{minDate:a.endOf("month").format("YYYY-MM-DD"),value:a.endOf("month").format("YYYY-MM-DD")})}else"2"===i&&this.endDateCalendarInstance.datetimepicker("setOptions",{minDate:a.endOf("M").format("YYYY-MM-DD"),value:a.endOf("M").format("YYYY-MM-DD")})},showRepeatText:function(e){var t=c(e.currentTarget).val(),i="";if("1"===t){c(this.frequencyText).text(recurring_strings.repeat_every_day),this.occurrence.weekly.hide(),this.occurrence.monthy.hide(),this.noFixedTime.show(),c(this.startDate).closest("tr").show(),this.hidePMI.hide();for(var a=1;a<=15;a++)i+='<option value="'+a+'">'+a+"</option>";this.repeatInterval.html(i)}else if("2"===t){c(this.frequencyText).text(recurring_strings.repeat_every_week),this.occurrence.weekly.show(),this.occurrence.monthy.hide(),this.noFixedTime.show(),c(this.startDate).closest("tr").show(),this.hidePMI.hide();for(a=1;a<=12;a++)i+='<option value="'+a+'">'+a+"</option>";this.repeatInterval.html(i)}else if("3"===t){c(this.frequencyText).text(recurring_strings.repeat_every_month),this.occurrence.weekly.hide(),this.occurrence.monthy.show(),this.noFixedTime.show(),c(this.startDate).closest("tr").show(),this.hidePMI.hide();for(a=1;a<=3;a++)i+='<option value="'+a+'">'+a+"</option>";this.repeatInterval.html(i)}else"4"===t&&(this.occurrence.weekly.hide(),this.occurrence.monthy.hide(),this.noFixedTime.hide(),c(this.startDate).closest("tr").hide(),this.hidePMI.show())},showHideRecurringFields:function(e){var t=c(this.frequency).val();c(e.currentTarget).is(":checked")?(c(this.recurringData).show(),this.enableRegistration.is(":checked")&&this.registrationType.show(),"1"===t?this.hidePMI.hide():"2"===t?(this.occurrence.weekly.show(),c(this.startDate).closest("tr").show(),this.hidePMI.hide()):"3"===t?(this.occurrence.monthy.show(),c(this.startDate).closest("tr").show(),this.hidePMI.hide()):"4"===t&&(this.occurrence.weekly.hide(),this.occurrence.monthy.hide(),this.noFixedTime.hide(),c(this.startDate).closest("tr").hide(),this.hidePMI.show())):(this.registrationType.hide(),this.recurringData.hide(),c(this.startDate).closest("tr").show(),this.hidePMI.show(),"2"===t?this.occurrence.weekly.hide():"3"===t?this.occurrence.monthy.hide():"4"===t&&(this.occurrence.weekly.hide(),this.occurrence.monthy.hide(),this.registrationSection.show()))},showHideBasedRegistrationsEnabledSetting:function(e){c(e.currentTarget).is(":checked")?(c(this.pmiSelector).val("1"),this.enableRecurring.is(":checked")&&this.registrationType.show()):this.registrationType.hide()},changeBasedonPMI:function(e){"2"===c(e.currentTarget).val()&&this.enableRegistration.removeAttr("checked")}},a={init:function(){this.cacheDOM(),this.evntListeners()},cacheDOM:function(){this.notify=c(".vczapi-pro-notify"),this.syncMethod=c(".vczapi-pro-sync-method"),this.showOnMeetingIDSelected=c(".vczapi-pro-show-sync-method-meetingid"),this.showOnUserSelected=c(".vczapi-pro-show-sync-method-user"),this.userID=c(".vczapi-pro-sync-by-user"),this.syncType=c(".vczapi-pro-sync-type"),this.selectUser=c(".vczapi-pro-sync-meeting-id-user-id"),this.meeting_id=c(".vczapi-pro-sync-meeting-id"),this.syncViaMeetingIDBtn=c("#vczapi-pro-sync-via-meeting-id")},evntListeners:function(){this.syncMethod.on("change",this.syncTypeSelected.bind(this)),this.syncViaMeetingIDBtn.on("click",{type:"sync_via_id"},this.syncViaMeetingID.bind(this)),this.userID.on("change",this.fetchRecurringMeetings.bind(this)),this.syncType.on("change",this.changeSyncType.bind(this)),c(document).on("click",".vczapi-pro-sync-meeting-by-id",{type:"sync_via_user"},this.syncViaMeetingID.bind(this))},syncTypeSelected:function(e){e.preventDefault(),1===parseInt(c(e.currentTarget).val())?(this.showOnMeetingIDSelected.show(),this.showOnUserSelected.hide()):(this.showOnMeetingIDSelected.hide(),this.showOnUserSelected.show())},syncViaMeetingID:function(e){var t="",i="",a="meeting";if(a="sync_via_user"===e.data.type?(t=c(e.currentTarget).data("user"),i=c(e.currentTarget).data("meeting"),c(e.currentTarget).data("type")):(t=c(this.selectUser).val(),i=c(this.meeting_id).val(),c(".vczapi-pro-sync-type option:selected").val()),""!==i&&""!==t){var n={host_id:t,meeting_id:i,meeting_type:a,action:"sync_meeting_id",type:"check"};this.checkBeforeSync(n)}else c(this.notify).html("<p>"+vczapi_pro_i10n.required+"</p>").addClass("vczapi-error"),this.animate(".vczapi-error")},checkBeforeSync:function(t){var i=this;c(i.notify).html("<p>Fetching.. Please wait..</p>"),c.post(ajaxurl,t).done(function(e){e.success?(i.sync(t).removeClass("vczapi-error").addClass("vczapi-success"),i.animate(".vczapi-success")):(c(i.notify).html("<p>"+e.data+"</p>").addClass("vczapi-error"),i.animate(".vczapi-error"))})},sync:function(e){var t=this;e.type="sync",c.post(ajaxurl,e).done(function(e){e.success?(c(t.notify).html("<p>"+e.data.msg+"</p>").removeClass("vczapi-error").addClass("vczapi-success"),t.animate(".vczapi-success")):(c(t.notify).html("<p>"+e.data+"</p>").addClass("vczapi-error"),t.animate(".vczapi-error"))})},changeSyncType:function(e){var t=c(".vczapi-pro-sync-by-user option:selected").val();"2"==c("input[name='sync_method']:checked").val()&&this.fetchRecurringMeetings(e,t)},fetchRecurringMeetings:function(e,t){e.preventDefault();var i=this;t=t||c(e.currentTarget).val();var a=c(".vczapi-pro-user-results");a.html("<p>"+vczapi_sync_i10n.before_sync+"</p>");var n=c(".vczapi-pro-sync-type").val();c.post(ajaxurl,{action:"sync_user",type:"fetch"}).done(function(e){e.success?(a.html("<p>"+e.data+"</p>"),c(".vczapi-pro-sync-meeting-table").DataTable({serverSide:!0,processing:!0,searching:!1,ajax:{url:ajaxurl,type:"POST",data:function(e){e.action="sync_user",e.type="check",e.user_id=t,e.mtg_type=n}},columnDefs:[{targets:0,orderable:!1}]})):(a.html("<p>"+e.data+"</p>").addClass("vczapi-error"),i.animate(".vczapi-error"))})},animate:function(e){c("html, body").animate({scrollTop:c(e).offset().top-20},500)}};e()});