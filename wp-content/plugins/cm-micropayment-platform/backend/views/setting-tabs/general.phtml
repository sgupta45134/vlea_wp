<?php
$args = array(
	'sort_order'   => 'ASC',
	'sort_column'  => 'post_title',
	'hierarchical' => 1,
	'exclude'      => '',
	'include'      => '',
	'meta_key'     => '',
	'meta_value'   => '',
	'authors'      => '',
	'child_of'     => 0,
	'parent'       => - 1,
	'exclude_tree' => '',
	'number'       => '',
	'offset'       => 0,
	'post_type'    => 'page',
	'post_status'  => 'publish'
);

include_once CMMP_PLUGIN_DIR . '/backend/views/setting-tabs/currencies.php';

$pages      = get_pages( $args );
$adminusers = get_users( 'role=administrator' );

$eddIntergration = CMMicropaymentPlatform::isEddIntegrationActive();
$disabled        = disabled( 1, $eddIntergration, false );
?>

<?php if ( $eddIntergration ) : ?>
    <div class="error">
        <p>The <strong>"CM Micropayment Platform"</strong> is currently using Easy Digital Downloads Checkout mode. All
            Payment related Settings have been disabled.</p>
    </div>
<?php endif; ?>

<form action="" method="post">
    <table class="form-table">
        <tbody>
		<?php if ( class_exists( 'Easy_Digital_Downloads' ) ): ?>
            <tr>
                <td colspan="2">
                    <h2><?php _e( 'Easy Digital Downloads - Integration' ); ?></h2>
                </td>
            </tr>
            <tr valign="top">
                <th scope="row"><?php _e( 'Use Easy Digital Downloads for Checkout' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Replaces the default MicroPayment checkout with the EDD checkout.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_use_edd_checkout">
                    <input type="checkbox" value="1" name="cm_micropayment_use_edd_checkout"
                           id="cm_micropayment_use_edd_checkout" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_use_edd_checkout' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Grant MicropaymentPoints per purchase' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Grant the user MicropaymentPoints after each EDD purchase.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_grant_points_per_purchase">
                    <input type="checkbox" value="1" name="cm_micropayment_grant_points_per_purchase"
                           id="cm_micropayment_grant_points_per_purchase" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_grant_points_per_purchase' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Allow to convert MicropaymentPoints into discounts' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Displays a form allowing to exchange the points to discounts. The form is generated by the [cm_micropayment_points_to_discount] shortcode.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_discount_code_exchange">
                    <input type="checkbox" value="1" name="cm_micropayment_discount_code_exchange"
                           id="cm_micropayment_discount_code_exchange" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_discount_code_exchange' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Allow only to buy products with MicropaymentPoints' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Makes "CM Micropayment Gateway" the only option when buying any product, except when buying Micropayment Points. This way, customers need to buy Points before making other purchases.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_payment_gateway_override">
                    <input type="checkbox" value="1" name="cm_micropayment_payment_gateway_override"
                           id="cm_micropayment_payment_gateway_override" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_payment_gateway_override' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Replace default currency with points when purchasing with Gateway' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Replaces default prices with points. For instance, "$3" will be displayed as "3 points"' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_edd_price_override">
                    <input type="checkbox" value="1" name="cm_micropayment_edd_price_override"
                           id="cm_micropayment_edd_price_override" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_edd_price_override', false ) ) ?>>
                </td>
            </tr>

		<?php endif; ?>

		<?php if ( class_exists( 'WeDevs_Dokan' ) ):
			?>
            <tr>
                <td colspan="2">
                    <h2><?php _e( 'Dokan - Integration' ); ?></h2>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Enable Dokan Integration?' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Sends points to the vendor wallet when a user purchase a product' ) ?>"></div>
                </th>
                <td>
                    <input type="checkbox" value="1" name="cm_micropayment_use_dokan"
                           id="cm_micropayment_use_dokan" <?php checked( '1',
						CMMicropaymentPlatform::get_option( 'cm_micropayment_use_dokan' ) ) ?>>
                </td>
            </tr>


            <tr valign="top">
                <th scope="row"><?php _e( 'Grant sale percentage to the admin wallet' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Grants the admin wallet commission for each sale' ) ?>"></div>
                </th>
                <td>

                    <input type="checkbox"  name="cm_micropayment_dokan_enable_percentage"
                           id="cm_micropayment_dokan_enable_percentage" <?php checked( 'on',
						CMMicropaymentPlatform::get_option( 'cm_micropayment_dokan_enable_percentage' ) ) ?>>

                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Admin wallet code' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'This wallet will receive the percentage of sale. Enter the full code with 32 characters (for instance, ae010ac8c293c02b7f78b3758b377c60' ) ?>"></div>
                </th>
                <td>

                    <input type="text"
                           value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_dokan_percentage_wallet' ) ?>"
                           name="cm_micropayment_dokan_percentage_wallet"
                           id="cm_micropayment_dokan_percentage_wallet"

                    >
                </td>
            </tr>
            <tr valign="top">
                <th scope="row"><?php _e( 'Percent' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'If this field empty, then will be no commission ' ) ?>"></div>
                </th>
                <td>
                    <input type="checkbox" value="" name="cm_micropayment_dokan_percentage"
                           id="cm_micropayment_use_dokan" <?php checked( '1',
						CMMicropaymentPlatform::get_option( 'cm_micropayment_use_dokan' ) ) ?>>
                </td>
            </tr>
		<?php
		endif; ?>
		<?php if ( class_exists( 'WooCommerce' ) ): ?>
            <tr>
                <td colspan="2">
                    <h2><?php _e( 'WooCommerce - Integration' ); ?></h2>
                </td>
            </tr>
            <tr valign="top">
                <th scope="row"><?php _e( 'Use WooCommerce for Checkout' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Replaces the default MicroPayment checkout with the WooCommerce checkout.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_use_woo_checkout">
                    <input type="checkbox" value="1" name="cm_micropayment_use_woo_checkout"
                           id="cm_micropayment_use_woo_checkout" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_use_woo_checkout' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Grant MicropaymentPoints per purchase' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Grant the user MicropaymentPoints after each WooCommerce purchase.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_woo_grant_points_per_purchase">
                    <input type="checkbox" value="1" name="cm_micropayment_woo_grant_points_per_purchase"
                           id="cm_micropayment_woo_grant_points_per_purchase" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_woo_grant_points_per_purchase' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Allow to convert MicropaymentPoints into discounts' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Displays a form allowing to exchange the points to discounts. The form is generated by the [cm_micropayment_points_to_discount] shortcode.' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_discount_woo_code_exchange">
                    <input type="checkbox" value="1" name="cm_micropayment_discount_woo_code_exchange"
                           id="cm_micropayment_discount_woo_code_exchange" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_discount_woo_code_exchange' ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Replace default currency in e-mails when purchasing with Gateway' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Replaces default prices with points. For instance, "$3" will be displayed as "3 points".' ) ?>"></div>
                </th>
                <td>
                    <input type="hidden" value="0" name="cm_micropayment_woo_price_override">
                    <input type="checkbox" value="1" name="cm_micropayment_woo_price_override"
                           id="cm_micropayment_discount_woo_code_exchange" <?php checked( '1', CMMicropaymentPlatform::get_option( 'cm_micropayment_woo_price_override', false ) ) ?>>
                </td>
            </tr>

            <tr valign="top">
                <th scope="row"><?php _e( 'Additional user who should get points for purchases' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Adds points to this wallet for each purchase' ) ?>"></div>
                </th>
                <td style="padding:15px 0px;">
                    <input type="radio" value="0" name="cm_micropayment_grant_points_to_admin_or_seller"
                           id="cm_micropayment_grant_points_to_admin_or_seller0" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_grant_points_to_admin_or_seller' ) == 0 ) ? 'checked="checked"' : '' ?> />
                    None <br/>

                    <input type="radio" value="1" name="cm_micropayment_grant_points_to_admin_or_seller"
                           id="cm_micropayment_grant_points_to_admin_or_seller1" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_grant_points_to_admin_or_seller' ) == 1 ) ? 'checked="checked"' : '' ?> />
                    Admin <br/>


                    <div class="cm_micropayment_grant_points_to_admin"
                         style="margin-bottom:5px;margin-top:5px;<?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_grant_points_to_admin_or_seller' ) != 1 ) ? ' display:none' : '' ?>">
                        <select name="cm_micropayment_grant_points_to_admin" id="wallet_page_id">
							<?php foreach ( $adminusers as $auser ):
								?>
                                <option value="<?php echo $auser->ID; ?>" <?php echo ( $auser->ID == CMMicropaymentPlatform::get_option( 'cm_micropayment_grant_points_to_admin' ) ) ? 'selected="selected"' : '' ?>><?php echo $auser->display_name . ' (' . $auser->user_email . ')'; ?></option>
							<?php endforeach; ?>
                        </select>
                    </div>

                    <!--
						<input type="radio" value="2" name="cm_micropayment_grant_points_to_admin_or_seller" id="cm_micropayment_grant_points_to_admin_or_seller2" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_grant_points_to_admin_or_seller' ) == 2 ) ? 'checked="checked"' : '' ?> /> Seller
						-->

                </td>
            </tr>
            <tr valign="top">
                <th scope="row"><?php _e( 'Final order status of purchasing micropayment points' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'When points are bought, the order status will be set to value of the option. Default is Completed' ) ?>"></div>
                </th>
                <td>
                    <select name="cm_micropayment_woo_points_order_status">
						<option value='processing' <?php selected(CMMicropaymentPlatform::get_option( 'cm_micropayment_woo_points_order_status', 'processing'), 'processing'); ?>>Processing</option>
						<option value='completed' <?php selected(CMMicropaymentPlatform::get_option( 'cm_micropayment_woo_points_order_status', 'processing'), 'completed'); ?>>Completed</option>
					</select>
                </td>
            </tr>
            <tr valign="top">
                <th scope="row"><?php _e( 'Order status after payment with micropayment points' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'When order is paid, its status will be set to value of the option. Default is Processing' ) ?>"></div>
                </th>
                <td>
                    <select name="cm_micropayment_woo_final_order_status">
						<option value='processing' <?php selected(CMMicropaymentPlatform::get_option( 'cm_micropayment_woo_final_order_status', 'processing'), 'processing'); ?>>Processing</option>
						<option value='completed' <?php selected(CMMicropaymentPlatform::get_option( 'cm_micropayment_woo_final_order_status', 'processing'), 'completed'); ?>>Completed</option>
					</select>
                </td>
            </tr>

		<?php
		endif;
		?>
        <tr>
            <td colspan="2">
                <h2><?php _e( 'Wallets' ); ?></h2>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Assign a single wallet to each customer' ) ?>
                <div class="field_help"
                     title="<?php _e( 'If checked, only one wallet per customer can exist. When this option is set, some other shortcodes are available.' ) ?>"></div>
            </th>
            <td>
                <input type="checkbox" value="1" name="cm_micropayment_assign_wallet_to_customer"
                       id="cm_micropayment_assign_wallet_to_customer" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_assign_wallet_to_customer' ) == 1 ) ? 'checked="checked"' : '' ?>>
                <div class="assign-wallet-per-customer-button-container"
                     style="margin-top:15px;<?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_assign_wallet_to_customer' ) != 1 ) ? ' display:none' : '' ?>">
                    <input type="submit" name="cm_micropayment_assign_wallet_to_customer_button"
                           class="button button-primary button-large"
                           value="<?php echo _e( "Generate missing wallets for existing users" ); ?>"/>
                </div>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Wallets quantity limit' ) ?>
                <div class="field_help"
                     title="<?php _e( "How many wallets can be assigned to single user." ) ?>"></div>
            </th>
            <td>
                <input type="number" min="1" step="1" name="cm_micropayment_number_of_wallets"
                       id="cm_micropayment_number_of_wallets"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_number_of_wallets', 1 ) ?>">
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Disable anonymous payments' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Requires entering the wallet ID during purchases.' ) ?>"></div>
            </th>
            <td>
                <input type="checkbox" value="1" name="cm_micropayment_disable_anonymous_payments"
                       id="cm_micropayment_disable_anonymous_payments" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_disable_anonymous_payments' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Hide \'create wallet\' button after wallet has been generated' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Hides the \'create wallet\' button generated from [create_wallet_button] shortcode after the request.' ) ?>"></div>
            </th>
            <td>
                <input type="checkbox" value="1" name="cm_micropayment_hide_create_button_after_action"
                       id="cm_micropayment_hide_create_button_after_action" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_hide_create_button_after_action' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Number of transactions in My Wallet' ) ?>
                <div class="field_help"
                     title="<?php _e( "How many transactions will be displayed in the wallet details page." ) ?>"></div>
            </th>
            <td>
                <input type="input" name="cm_micropayment_number_of_transactions"
                       id="cm_micropayment_number_of_transactions"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_number_of_transactions', '3' ) ?>">
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Initial points amount in the wallet' ) ?>
                <div class="field_help"
                     title="<?php _e( "How many points will each newly created wallet have." ) ?>"></div>
            </th>
            <td>
                <input type="input" name="cm_micropayment_initial_wallet_points"
                       id="cm_micropayment_initial_wallet_points"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_initial_wallet_points', '0' ) ?>">
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Allow to charge inactive wallets' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Allow users to charge inactive wallets (fraud protection)' ) ?>"></div>
            </th>
            <td><input type="hidden" value="0" name="cm_micropayment_allow_charge_inactive_wallets">
			<input type="checkbox" value="1" name="cm_micropayment_allow_charge_inactive_wallets"
                       id="cm_micropayment_allow_charge_inactive_wallets" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_allow_charge_inactive_wallets' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Transaction fee for adding points (flat or percentage%)' ) ?>
                <div class="field_help"
                     title="In Points <?php _e( 'Charge users a flat amount every time they top up their wallet. The field does support percentages. This transaction will be displayed on the wallet log.' ) ?>"></div>
            </th>
            <td><input type="input" name="cm_micropayment_adding_points_transaction_fee"
                       id="cm_micropayment_adding_points_transaction_fee"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_adding_points_transaction_fee', '0' ) ?>">
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Transaction fee for subtracting points (flat or percentage%)' ) ?>
                <div class="field_help"
                     title="In Points <?php _e( 'Charge users a flat amount every time they spend points. The field does support percentages. This transaction will be displayed on the wallet log.' ) ?>"></div>
            </th>
            <td><input type="input" name="cm_micropayment_subtracting_points_transaction_fee"
                       id="cm_micropayment_subtracting_points_transaction_fee"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_subtracting_points_transaction_fee', '0' ) ?>">
            </td>
        </tr>
        <tr valign="top">
            <th scope="row">
				<?php _e( 'Allow decimals? (e.g. 2.34 points)' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Supports decimals and centesimals for wallet operations. Milesimals and lower units will be disregarded - for example, 1.2399 = 1.23.' ) ?>"></div>
            </th>
            <td>
                <input type="checkbox"
                       value="1" name="cm_micropayment_enable_decimal" id="cm_micropayment_enable_decimal"
					<?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_enable_decimal' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>

        </tr>
        <tr valign="top">
            <th scope="row">
				<?php _e( 'When points are shown, round decimals to' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Rounds points every time the points are shown. Only works if you enable decimals' ) ?>"></div>
            </th>
            <td>
                <select id="cm_micropayment_rounds_decimal" name="cm_micropayment_rounds_decimal">


                    <option value="high" <?php
					selected( CMMicropaymentPlatform::get_option( 'cm_micropayment_rounds_decimal', '' ), 'high' ); ?>>
                        Highest integer (1.5 → 2)
                    </option>
                    <option value="lowest" <?php
					selected( CMMicropaymentPlatform::get_option( 'cm_micropayment_rounds_decimal', '' ), 'lowest' ); ?>>
                        Lowest integer (1.5 → 1)


                    </option>
                </select>
            </td>
        </tr>
        <tr valign="top">
            <th scope="row">
				<?php _e( 'Enable wallet for receiving points from store purchases' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Points that users spend in WooCommerce and EDD store goes to a special separate wallet' ) ?>"></div>
            </th>
            <td>
                <input type="checkbox" value="1" name="cm_micropayment_store_purchases_wallet"
                       id="cm_micropayment_store_purchases_wallet" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_store_purchases_wallet' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <h2><?php _e( 'Admin Dashboard' ); ?></h2>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Show Dashboard widget' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Displays a widget with the wallet ID and number of points in the Admin Dashboard' ) ?>"></div>
            </th>
            <td><input type="checkbox" value="1" name="cm_micropayment_show_dashboard_widget"
                       id="cm_micropayment_show_dashboard_widget" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_show_dashboard_widget' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>
        </tr>


        <tr valign="top">
            <th scope="row">
				<?php _e( 'Payment Currency' ) ?>
                <div class="field_help" title="<?php _e( 'Select currency' ) ?>"></div>
            </th>
            <td>
                <select id="cm_micropayment_unit_currency" name="cm_micropayment_unit_currency">
				<?php
					$current_currency_code = CMMicropaymentPlatform::get_option( 'cm_micropayment_unit_currency', '' );
					foreach ( $currencies as $code => $name ) {
						echo "<option value='$code' " . selected($current_currency_code, $code) . ">" . __($name) . " - ". $code ."</option>";
					}
				?>
                </select>
            </td>
        </tr>
        <tr valign="top">
            <th scope="row"><?php _e( 'Currency Symbol' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Select the symbol of the currency. If set it will be used instead of the currency name. e.g. € or $' ) ?>"></div>
            </th>
            <td>
                <input type="text"
                       value="<?php echo( CMMicropaymentPlatform::get_option( 'cm_micropayment_unit_currency_symbol', '' ) ); ?>"
                       name="cm_micropayment_unit_currency_symbol" id="cm_micropayment_unit_currency_symbol"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <h2><?php _e( 'Presentation' ); ?></h2>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Wallet page' ) ?>
                <div class="field_help"
                     title="<?php _e( 'The page which should hold the information about user\'s wallet id, transactions etc.' ) ?>"></div>
            </th>
            <td>
                <select name="cm_micropayment_wallet_page_id" id="wallet_page_id">
					<?php foreach ( $pages as $page ): ?>
                        <option value="<?php echo $page->ID; ?>" <?php echo ( $page->ID == CMMicropaymentPlatform::get_option( 'cm_micropayment_wallet_page_id' ) ) ? 'selected="selected"' : '' ?>><?php echo $page->post_title; ?></option>
					<?php endforeach; ?>
                </select>
				<?php
				$walletPageId = CMMicropaymentPlatform::get_option( 'cm_micropayment_wallet_page_id' );
				$permalink    = get_permalink( $walletPageId );
				if ( ! empty( $permalink ) ):
					?>
                    <a href="<?php echo $permalink; ?>"
                       target="_blank"><?php _e( '[go to page]', 'cm-micropayment-platform' ); ?></a>
				<?php endif; ?>
            </td>
        </tr>
        <tr valign="top">
            <th scope="row"><?php _e( 'Checkout Page' ) ?>
                <div class="field_help"
                     title="<?php _e( 'The page where users can buy the virtual currency. It should have the shortcode [cm_micropayment_checkout]' ) ?>"></div>
            </th>
            <td>
                <select name="cm_micropayment_checkout_page_id" id="checkout_page_id">
					<?php foreach ( $pages as $page ): ?>
                        <option value="<?php echo $page->ID; ?>" <?php echo ( $page->ID == CMMicropaymentPlatform::get_option( 'cm_micropayment_checkout_page_id' ) ) ? 'selected="selected"' : '' ?>><?php echo $page->post_title; ?></option>
					<?php endforeach; ?>
                </select>
				<?php
				$checkoutPageId = CMMicropaymentPlatform::get_option( 'cm_micropayment_checkout_page_id' );
				$permalink      = get_permalink( $checkoutPageId );
				if ( ! empty( $permalink ) ):
					?>
                    <a href="<?php echo $permalink; ?>"
                       target="_blank"><?php _e( '[go to page]', 'cm-micropayment-platform' ); ?></a>
				<?php endif; ?>
            </td>
        </tr>

		<?php if ( ! $eddIntergration ) : ?>
            <tr valign="top">
                <th scope="row"><?php _e( 'Payment success page' ) ?>
                    <div class="field_help"
                         title="<?php _e( 'Shown after payment success' ) ?>"></div>
                </th>
                <td>
                    <select name="cm_micropayment_success_page_id" id="success_page_id">
						<?php foreach ( $pages as $page ): ?>
                            <option value="<?php echo $page->ID; ?>" <?php echo ( $page->ID == CMMicropaymentPlatform::get_option( 'cm_micropayment_success_page_id' ) ) ? 'selected="selected"' : '' ?>><?php echo $page->post_title; ?></option>
						<?php endforeach; ?>
                    </select>
					<?php
					$successPageId = CMMicropaymentPlatform::get_option( 'cm_micropayment_success_page_id' );
					$permalink     = get_permalink( $successPageId );
					if ( ! empty( $permalink ) ):
						?>
                        <a href="<?php echo $permalink; ?>"
                           target="_blank"><?php _e( '[go to page]', 'cm-micropayment-platform' ); ?></a>
					<?php endif; ?>
                </td>
            </tr>
            <tr valign="top">
                <th scope="row"><?php _e( 'Payment error page' ) ?>
                    <div class="field_help" title="<?php _e( 'Shown after payment error' ) ?>"></div>
                </th>
                <td>
                    <select name="cm_micropayment_error_page_id" id="failure_page_id">
						<?php foreach ( $pages as $page ): ?>
                            <option value="<?php echo $page->ID; ?>" <?php echo ( $page->ID == CMMicropaymentPlatform::get_option( 'cm_micropayment_error_page_id' ) ) ? 'selected="selected"' : '' ?>><?php echo $page->post_title; ?></option>
						<?php endforeach; ?>
                    </select>
					<?php
					$errorPageId = CMMicropaymentPlatform::get_option( 'cm_micropayment_error_page_id' );
					$permalink   = get_permalink( $errorPageId );
					if ( ! empty( $permalink ) ):
						?>
                        <a href="<?php echo $permalink; ?>"
                           target="_blank"><?php _e( '[go to page]', 'cm-micropayment-platform' ); ?></a>
					<?php endif; ?>
                </td>
            </tr>
		<tr>
            <td colspan="2">
                <h2><?php _e( 'Appearance' ); ?></h2>
            </td>
        </tr>

        <tr valign="top">
            <th scope="row"><?php _e( 'Show comment column in transaction history' ) ?>
                <div class="field_help"
                     title="<?php _e( 'Show comment column in wallet transactions history table.' ) ?>"></div>
            </th>
            <td>
                <select name="cm_micropayment_wallet_history_show_comment" id="wallet_history_show_comment">
					<?php
						$show_comment_options = array(
							'0' => 'Nobody',
							'1' => 'Admins only',
							'2' => 'Logged in users'
						);
						foreach ( $show_comment_options as $k => $v ) : ?>
                        <option value="<?php echo $k; ?>" <?php selected(CMMicropaymentPlatform::get_option( 'cm_micropayment_wallet_history_show_comment', 0 ), $k ) ?>><?php echo $v; ?></option>
					<?php endforeach; ?>
                </select>
            </td>
        </tr>
		<?php endif; ?>

		<tr valign="top">
            <th scope="row"><?php _e( 'Show the input field instead of radio selection' ) ?>
                <div class="field_help"
                     title="<?php _e( 'If eanbled the show the input field instead of radio selection for purchase points on checkout page.' ) ?>"></div>
            </th>
            <td><input type="checkbox" value="1" name="cm_micropayment_show_input"
                       id="cm_micropayment_show_input" <?php echo ( CMMicropaymentPlatform::get_option( 'cm_micropayment_show_input' ) == 1 ) ? 'checked="checked"' : '' ?>>
            </td>
        </tr>
		<tr valign="top">
            <th scope="row"><?php _e( 'Default Points' ) ?>
                <div class="field_help"
                     title="<?php _e( "Here you need to define default points, this will use when you will enable above option." ) ?>"></div>
            </th>
            <td>
                <input type="input" name="cm_micropayment_default_points"
                       id="cm_micropayment_default_points"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_default_points', '10' ) ?>">
            </td>
        </tr>
		<tr valign="top">
            <th scope="row"><?php _e( 'Point cost value' ) ?>
                <div class="field_help"
                     title="<?php _e( "Here you need to define point cost value, this will use when you will enable above option." ) ?>"></div>
            </th>
            <td>
                <input type="input" name="cm_micropayment_point_cost_value"
                       id="cm_micropayment_point_cost_value"
                       value="<?php echo CMMicropaymentPlatform::get_option( 'cm_micropayment_point_cost_value', '1' ) ?>">
            </td>
        </tr>

        </tbody>
    </table>
    <p class="submit"><input type="submit" value="<?php _e( 'Save' ) ?>" class="button button-primary" id="submit"
                             name="submit"></p>
</form>
